$(document).ready(function(){function e(){$("#submit_form").html("Yes!"),$(".submit_form_wrapper").animate({width:"0px"}),$(".new_record").slideUp(),$(".submit_form_wrapper").hasClass("expanded")&&($(this).html("No..."),$(".submit_form_wrapper").removeClass("expanded"))}function t(){$(".scores").html('<img src="images/loader.gif" width="20" height="20" /> Loading...'),$.post("controller.php",{action:"load_scores",token:ajax_token},function(e){var t=s("ajax_token");t&&(ajax_token=t);var a=$.parseJSON(e);if(a.length>0){var i=new Array;i.left='<table class="player_scores left">',i.right="";var l=1,n="left";a.length>5&&(i.right='<table class="player_scores right">');for(var c in a)if(void 0!=a[c].score&&void 0!=a[c].name){var d=parseFloat(a[c].score);r.push(d),n=5>=l?"left":"right",i[n]+="<tr>",i[n]+='<td class="player_position">'+l+"</td>",i[n]+='<td class="player_name">'+a[c].name+"</td>",i[n]+='<td class="player_score">'+d.toFixed(5)+"</td>",i[n]+="</tr>",l++}i.left+="</table>",a.length>5&&(i.right+="</table>"),$(".scores").html(i.left+i.right),o=Math.min.apply(Math,r)}else $(".scores").html("There are no scores yet.")})}function s(e){for(var t=e+"=",s=document.cookie.split(";"),r=0;r<s.length;r++){for(var o=s[r];" "==o.charAt(0);)o=o.substring(1,o.length);if(0==o.indexOf(t))return o.substring(t.length,o.length)}return!1}var r=new Array,o=0,a=0,i=0,l=$("body").height();t();new ScrollSpeedMonitor(function(e){return $("body")[0].scrollHeight!=l?void alert("Please don't mess with the scroll height."):($(".last_scrolling_speed").html(e.toFixed(5)),void(e>a&&(a=e.toFixed(5),$(".fastest_scroll").html(a),$.post("controller.php",{action:"fastest_scroll",score:a,token:ajax_token,scroller_height:$("body")[0].scrollHeight},function(){var e=s("ajax_token");e&&(ajax_token=e)}),a>0&&(a>o||r.length<10)&&($(".submit_loading").slideUp(),$(".submit_success").slideUp(),$(".submit_error").slideUp(),$(".new_record").slideDown()))))});$("#submit_form").click(function(){if($(".submit_form_wrapper").hasClass("expanded")){var r=$("#name").val(),o=a;r?(e(),$(".submit_loading").slideDown(),$.post("controller.php",{action:"submit_score",name:r,score:o,token:ajax_token,scroller_height:$("body").height()},function(e){var r=s("ajax_token");r&&(ajax_token=r),$(".submit_loading").slideUp(),"success"==e?($(".submit_success").slideDown(),t(),i=setTimeout(function(){$(".submit_success").slideUp(),clearTimeout(i)},3e3)):$(".submit_error").slideDown()})):alert("Please enter your name to submit your score.")}else $(this).html("Submit score"),$(".submit_form_wrapper").animate({width:$(".submit_form").width()}).addClass("expanded"),$("#name").focus(),$("#cancel_submit").html("Cancel")}),$("#cancel_submit").click(function(){e()})});